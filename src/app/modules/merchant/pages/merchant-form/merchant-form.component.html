<div [formGroup]="form">
  <div class="p-grid ml-2 m-2">
    <div class="p-col" style="text-align: right">
      <span
        (click)="backToList()"
        class="mt-2 ml-3 header-left"
        style="color: #0080f9; cursor: pointer"
        >Merchant</span
      >
      <span class="mt-2 ml-2 mr-2 header-left">></span>
      <span class="mt-2 header-left"
        >{{ formType == "add" ? "Add" : "Edit" }} Merchant</span
      >
      <p-button
        class="mr-3 cancel-button"
        label="Cancel"
        [text]="true"
        (click)="backToList()"
        size="small"
      />

      <p-button
        (click)="submit()"
        [disabled]="!form?.valid"
        label="{{ formType == 'add' ? 'Add' : 'Save' }}"
        size="small"
      >
      </p-button>
    </div>
  </div>

  <hr class="header-divider" />

  <div class="merchants-form">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="grid">
        <div class="col-8 p-0 inputs-div">
          <div class="p-20 flex flex-wrap">
            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="merchantId"
                  >ID
                  <span class="p-error"> * </span>
                </label>

                <input
                  [ngClass]="{
                    'ng-invalid ng-dirty': f.merchantId?.errors?.required
                  }"
                  type="number"
                  pInputText
                  formControlName="merchantId"
                />

                <div
                  *ngIf="
                    f.merchantId.errors &&
                    (f.merchantId.dirty || f.merchantId.touched)
                  "
                  class="invalmerchantId-feedback"
                >
                  <div
                    class="fs-10 color-red"
                    *ngIf="f.merchantId.errors.required"
                  >
                    merchantId field is required
                  </div>
                </div>
              </div>
            </div>

            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="merchantNameEN"
                  >Merchant Name [EN] <span class="p-error"> * </span>
                </label>
                <input
                  [ngClass]="{
                    'ng-invalid ng-dirty': f.merchantNameEN?.errors?.required
                  }"
                  type="text"
                  pInputText
                  formControlName="merchantNameEN"
                />

                <div
                  *ngIf="
                    f.merchantNameEN.errors &&
                    (f.merchantNameEN.dirty || f.merchantNameEN.touched)
                  "
                  class="invalid-feedback"
                >
                  <div class="fs-10 color-red">
                    <span *ngIf="f.merchantNameEN.errors.required">
                      Merchant Name [EN] field is required
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="merchantNameAR"
                  >Merchant Name [AR] <span class="p-error"> * </span>
                </label>
                <input
                  [ngClass]="{
                    'ng-invalid ng-dirty': f.merchantNameAR?.errors?.required
                  }"
                  type="text"
                  pInputText
                  formControlName="merchantNameAR"
                />

                <div
                  *ngIf="
                    f.merchantNameAR.errors &&
                    (f.merchantNameAR.dirty || f.merchantNameAR.touched)
                  "
                  class="invalid-feedback"
                >
                  <div class="fs-10 color-red">
                    <span *ngIf="f.merchantNameAR.errors.required">
                      Merchant Name [AR] field is required
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="userName"
                  >Username <span class="p-error"> * </span>
                </label>
                <input
                  [ngClass]="{
                    'ng-invalid ng-dirty': f.userName?.errors?.required
                  }"
                  type="text"
                  pInputText
                  formControlName="userName"
                />

                <div
                  *ngIf="
                    f.userName.errors &&
                    (f.userName.dirty || f.userName.touched)
                  "
                  class="invalid-feedback"
                >
                  <div
                    class="fs-10 color-red"
                    *ngIf="f.userName.errors.required"
                  >
                    Username field is required
                  </div>
                </div>
              </div>
            </div>

            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="categoryId"
                  >Merchant category code <span class="p-error"> * </span>
                </label>

                <p-dropdown
                  [options]="categories"
                  formControlName="categoryId"
                  [optionValue]="'id'"
                  optionLabel="nameEn"
                  filter="true"
                />
                <div
                  *ngIf="
                    f.categoryId.errors &&
                    (f.categoryId.dirty || f.categoryId.touched)
                  "
                  class="invalid-feedback"
                >
                  <div
                    class="fs-10 color-red"
                    *ngIf="f.categoryId.errors.required"
                  >
                    Category field is required
                  </div>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="userName">Phone Number </label>
                <input
                  [ngClass]="{
                    'ng-invalid ng-dirty': f.phoneNumber?.errors?.min
                  }"
                  type="text"
                  pInputText
                  formControlName="phoneNumber"
                />

                <div
                  *ngIf="
                    f.phoneNumber.errors &&
                    (f.phoneNumber.dirty || f.phoneNumber.touched)
                  "
                  class="invalid-feedback"
                >
                  <div class="fs-10 color-red">
                    <span *ngIf="f.phoneNumber?.errors?.['minlength']">
                      Minimum length is 11 digits
                    </span>
                    <span *ngIf="f.phoneNumber?.errors?.['maxlength']">
                      Maximum length is 11 digits
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <!-- <div class="grid mt-2"> -->
            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="service-agent">Assigned Service Agent </label>
                <p-dropdown
                  [options]="serviceAgents"
                  formControlName="serviceAgentId"
                  [optionValue]="'id'"
                  optionLabel="nameEn"
                  filter="true"
                />
                <div
                  *ngIf="
                    f.serviceAgentId.errors &&
                    (f.serviceAgentId.dirty || f.serviceAgentId.touched)
                  "
                  class="invalid-feedback"
                >
                  <div
                    class="fs-10 color-red"
                    *ngIf="f.serviceAgentId.errors.required"
                  >
                    Service Agent field is required
                  </div>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="flex flex-column gap-2">
                <label for="sales-agent">Assigned Sales Agent </label>
                <p-dropdown
                  [options]="salesAgents"
                  formControlName="salesAgentId"
                  [optionValue]="'id'"
                  optionLabel="nameEn"
                  filter="true"
                />
                <div
                  *ngIf="
                    f.salesAgentId.errors &&
                    (f.salesAgentId.dirty || f.salesAgentId.touched)
                  "
                  class="invalid-feedback"
                >
                  <div
                    class="fs-10 color-red"
                    *ngIf="f.salesAgentId.errors.required"
                  >
                    Sales Agent field is required
                  </div>
                </div>
              </div>
            </div>
            <!-- </div> -->
          </div>
        </div>

        <div class="col-4 p-0">
          <div class="location-form p-20">
            <div class="location-text">
              <p class="font-bold fs-11">Location</p>
            </div>
            <div class="grid">
              <div class="col-5">
                <div class="flex flex-column gap-2">
                  <label for="longitudeInput"
                    >Long
                    <label *ngIf="false" for="" style="color: red !important"
                      >*</label
                    ></label
                  >
                  <input
                    [ngClass]="{
                      'ng-invalid ng-dirty': f.longitudeInput?.errors?.required
                    }"
                    type="text"
                    pInputText
                    formControlName="longitudeInput"
                  />
                </div>
              </div>
              <div class="col-5">
                <div class="flex flex-column gap-2">
                  <label for="latitudeInput"
                    >Lat
                    <label for="" *ngIf="false" style="color: red !important"
                      >*</label
                    >
                  </label>
                  <input
                    [ngClass]="{
                      'ng-invalid ng-dirty': f.latitudeInput?.errors?.required
                    }"
                    type="text"
                    pInputText
                    formControlName="latitudeInput"
                  />
                </div>
              </div>
              <div class="col-2">
                <div class="add-item mt-5" (click)="pinLocation()">
                  <span class="add-btn">
                    <i class="pi pi-map-marker" style="font-size: 13px"></i>
                  </span>
                </div>
              </div>
            </div>
            <div>
              <div class="map-container">
                <oc-map [mode]="formType" [coordinates]="coordinates"></oc-map>
              </div>

              <div class="location-container fs-11 mt-3">
                <div class="col-6 coordinate">
                  <span class="mt-2"
                    >Long:
                    {{ form?.get("longitude").value | strLimit : 10 }}</span
                  >
                </div>
                <p-divider class="divider" />
                <div class="col-6 coordinate">
                  <span class="mt-2"
                    >Lat:
                    {{ form?.get("latitude").value | strLimit : 10 }}</span
                  >
                </div>
              </div>
              <div *ngIf="!form.get('latitude').value">
                <span style="color: red; font-size: 10px"
                  >Please select location on map!</span
                >
              </div>
            </div>
            <div class="grid mt-2">
              <div class="col-6">
                <div class="flex flex-column gap-2">
                  <label for="regionId"
                    >Region <span class="p-error"> * </span>
                  </label>
                  <p-dropdown
                    (onChange)="regionChanged($event)"
                    [options]="regionsList"
                    formControlName="regionId"
                    [optionValue]="'id'"
                    optionLabel="nameEn"
                    filter="true"
                  />
                  <div
                    *ngIf="
                      f.regionId.errors &&
                      (f.regionId.dirty || f.regionId.touched)
                    "
                    class="invalid-feedback"
                  >
                    <div
                      class="fs-10 color-red"
                      *ngIf="f.regionId.errors.required"
                    >
                      Region field is required
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="flex flex-column gap-2">
                  <label for="cityId"
                    >City <span class="p-error"> * </span>
                  </label>
                  <p-dropdown
                    [options]="citiesList"
                    (onChange)="cityChanged($event)"
                    formControlName="cityId"
                    [optionValue]="'id'"
                    optionLabel="nameEn"
                    filter="true"
                  />
                  <div
                    *ngIf="
                      f.cityId.errors && (f.cityId.dirty || f.cityId.touched)
                    "
                    class="invalid-feedback"
                  >
                    <div
                      class="fs-10 color-red"
                      *ngIf="f.cityId.errors.required"
                    >
                      City field is required
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="grid pt-10">
              <div class="col-6">
                <div class="flex flex-column gap-2">
                  <label for="zoneId"
                    >Zone <span class="p-error"> * </span>
                  </label>
                  <p-dropdown
                    [options]="zonesList"
                    formControlName="zoneId"
                    [optionValue]="'id'"
                    optionLabel="nameEn"
                    filter="true"
                  />
                  <div
                    *ngIf="
                      f.zoneId.errors && (f.zoneId.dirty || f.zoneId.touched)
                    "
                    class="invalid-feedback"
                  >
                    <div
                      class="fs-10 color-red"
                      *ngIf="f.zoneId.errors.required"
                    >
                      Zone field is required
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="grid pt-10">
              <div class="col-12">
                <div class="flex flex-column gap-2">
                  <label for="address">Address </label>
                  <input
                    [ngClass]="{
                      'ng-invalid ng-dirty': f.address?.errors?.required
                    }"
                    type="text"
                    pInputText
                    formControlName="address"
                  />
                </div>
              </div>
            </div>
            <div class="grid pt-10">
              <div class="col-12">
                <div class="flex flex-column gap-2">
                  <label for="landMark">Landmark</label>
                  <input
                    [ngClass]="{
                      'ng-invalid ng-dirty': f.landMark?.errors?.required
                    }"
                    type="text"
                    pInputText
                    formControlName="landMark"
                  />
                  <div
                    *ngIf="
                      f.landMark.errors &&
                      (f.landMark.dirty || f.landMark.touched)
                    "
                    class="invalid-feedback"
                  >
                    <div
                      class="fs-10 color-red"
                      *ngIf="f.landMark.errors.required"
                    >
                      Landmark field is required
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
